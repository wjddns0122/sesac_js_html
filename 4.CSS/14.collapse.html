<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeSAC Random Seat Map</title>
    <style>
        :root {
            --bg: #f6f7fb;
            --card: #ffffff;
            --text: #1f2833;
            --muted: #5c6470;
            --accent: #4c6ef5;
            --accent-soft: rgba(76, 110, 245, 0.1);
            --success: #1cb370;
            --warning: #f08c00;
        }

        html {
            height: 100%;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: "Segoe UI", "Apple SD Gothic Neo", sans-serif;
            background: radial-gradient(circle at top, #e3e8ff 0%, var(--bg) 45%);
            color: var(--text);
            min-height: 100%;
            display: flex;
            justify-content: center;
            padding: 32px 16px;
        }

        main {
            width: min(1100px, 100%);
            background: var(--card);
            border-radius: 28px;
            box-shadow: 0 45px 80px rgba(10, 27, 61, 0.15);
            padding: 48px 56px;
        }

        h1 {
            margin: 0;
            font-size: 40px;
            letter-spacing: -0.5px;
        }

        .intro {
            margin-bottom: 32px;
        }

        .intro p {
            margin: 8px 0 0;
            color: var(--muted);
            max-width: 60ch;
            line-height: 1.5;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .controls button {
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.15s;
            padding: 16px;
        }

        .controls button.shuffle {
            background: var(--accent);
            color: #fff;
            box-shadow: 0 18px 35px rgba(76, 110, 245, 0.25);
        }

        .controls button.reset {
            background: var(--accent-soft);
            color: var(--accent);
        }

        .controls button:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        .status {
            padding: 16px 19px;
            border-radius: 16px;
            background: var(--bg);
            font-weight: 600;
            color: var(--muted);
            margin-bottom: 32px;
            border: 1px solid transparent;
        }

        .status.success {
            border-color: rgba(28, 179, 112, 0.3);
            background: rgba(28, 179, 112, 0.12);
            color: var(--success);
        }

        .status.error {
            border-color: rgba(240, 140, 0, 0.4);
            background: rgba(240, 140, 0, 0.12);
            color: var(--warning);
        }

        .seat-groups {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
        }

        .group-card {
            background: var(--card);
            border-radius: 22px;
            padding: 24px;
            border: 1px solid rgba(76, 110, 245, 0.12);
            box-shadow: 0 12px 30px rgba(15, 32, 77, 0.08);
            position: relative;
            overflow: hidden;
        }

        .group-card::after {
            content: "";
            position: absolute;
            inset: 0;
            opacity: 0.08;
            background: radial-gradient(circle at top right, var(--group-color, var(--accent)), transparent 60%);
        }

        .group-header {
            margin-bottom: 20px;
            position: relative;
        }

        .group-header h3 {
            margin: 0;
            font-size: 21px;
            color: var(--group-color, var(--accent));
        }

        .group-header p {
            margin: 3px 0 0;
            color: var(--muted);
            font-size: 15px;
        }

        .group-size {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
        }

        .seat-list {
            list-style: none;
            margin: 0;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 13px;
        }

        .seat {
            background: var(--bg);
            border-radius: 16px;
            padding: 13px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            border: 1px dashed rgba(76, 110, 245, 0.2);
            min-height: 70px;
        }

        .seat-label {
            font-size: 14px;
            color: var(--muted);
        }

        .seat strong {
            font-size: 18px;
            color: var(--text);
            word-break: break-word;
        }

        .seat.taken {
            border-style: solid;
            border-color: var(--group-color, var(--accent));
            background: rgba(76, 110, 245, 0.08);
        }

        .history {
            margin-top: 40px;
        }

        .history h2 {
            margin: 0 0 13px;
            font-size: 19px;
        }

        .history-list {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            background: var(--bg);
            border-radius: 14px;
            padding: 13px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
        }

        .timestamp {
            font-size: 13px;
            color: var(--muted);
        }

        @media (max-width: 700px) {
            .controls {
                grid-template-columns: 1fr;
            }

            .seat-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <main>
        <div class="intro">
            <h1>SeSAC 좌석 랜덤 배정</h1>
            <p>13명의 훈련생을 한 번에 섞어 새 자리를 만들어 보세요. 버튼을 누를 때마다 지난 주와 다른 자리를 최대한 찾아 드립니다.</p>
        </div>

        <div class="controls">
            <button type="button" id="shuffleButton" class="shuffle">이번 주 자리 다시 뽑기</button>
            <button type="button" id="restoreButton" class="reset">지난 주 배치로 보기</button>
        </div>

        <p id="statusMessage" class="status">현재는 지난 주 배치를 표시하고 있어요. 버튼을 눌러 새로운 자리를 만들어 보세요.</p>

        <section id="seatGroups" class="seat-groups" aria-live="polite"></section>

        <section class="history">
            <h2>이번 주 배정 기록</h2>
            <ul id="historyList" class="history-list"></ul>
        </section>
    </main>

    <script>
        const groupBlueprints = [
            { id: "alpha", label: "Creative Pod", capacity: 4, note: "벽면TV 앞 쪽 4인 자리", color: "#ff6b6b" },
            { id: "beta", label: "Focus Pod", capacity: 4, note: "강사님 앞 4인 자리", color: "#845ef7" },
            { id: "gamma", label: "Team Space", capacity: 3, note: "창가 쪽 3인 테이블", color: "#20c997" },
            { id: "delta", label: "Pair Desk", capacity: 2, note: "창가 쪽 2인 팀", color: "#fd7e14" }
        ];

        const lastWeekAssignments = {
            "alpha-1": "신지원",
            "alpha-2": "남기정",
            "alpha-3": "변영찬",
            "alpha-4": "김윤군",
            "beta-1": "이지안",
            "beta-2": "김준성",
            "beta-3": "김주연",
            "beta-4": "공정배",
            "gamma-1": "이유랑",
            "gamma-2": "노정운",
            "gamma-3": "장수빈",
            "delta-1": "박호정",
            "delta-2": "조진희"
        };

        const studentNames = Object.values(lastWeekAssignments);

        const seats = groupBlueprints.flatMap(group => {
            return Array.from({ length: group.capacity }, (_, idx) => {
                const seatId = `${group.id}-${idx + 1}`;
                return {
                    seatId,
                    label: `${group.label} ${idx + 1}`,
                    groupId: group.id,
                    occupant: lastWeekAssignments[seatId] || null
                };
            });
        });

        let previousAssignments = { ...lastWeekAssignments };
        const history = [];

        const seatGroupsContainer = document.getElementById("seatGroups");
        const statusMessage = document.getElementById("statusMessage");
        const historyList = document.getElementById("historyList");
        const shuffleButton = document.getElementById("shuffleButton");
        const restoreButton = document.getElementById("restoreButton");

        function renderSeatGroups() {
            seatGroupsContainer.innerHTML = groupBlueprints.map(group => {
                const groupSeats = seats.filter(seat => seat.groupId === group.id);
                const seatItems = groupSeats.map(seat => {
                    const takenClass = seat.occupant ? "taken" : "";
                    const occupant = seat.occupant ? seat.occupant : "Available";
                    return `
                        <li class="seat ${takenClass}">
                            <span class="seat-label">${seat.label}</span>
                            <strong>${occupant}</strong>
                        </li>
                    `;
                }).join("");

                return `
                    <article class="group-card" style="--group-color: ${group.color}">
                        <header class="group-header">
                            <span class="group-size">${group.capacity} Seats</span>
                            <h3>${group.label}</h3>
                            <p>${group.note}</p>
                        </header>
                        <ul class="seat-list">
                            ${seatItems}
                        </ul>
                    </article>
                `;
            }).join("");
        }

        function updateHistory() {
            if (!history.length) {
                historyList.innerHTML = "<li class=\"history-item\">아직 새로운 배치 기록이 없어요.</li>";
                return;
            }

            historyList.innerHTML = history.map(item => `
                <li class="history-item">
                    <span><strong>${item.summary}</strong>${item.detail ? ` · ${item.detail}` : ""}</span>
                    <span class="timestamp">${item.time}</span>
                </li>
            `).join("");
        }

        function setStatus(message, type = "") {
            statusMessage.textContent = message;
            statusMessage.className = `status ${type}`.trim();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function applyLayout(layoutMap) {
            seats.forEach(seat => {
                seat.occupant = layoutMap[seat.seatId];
            });
        }

        function attemptNewLayout(attempts = 800) {
            let bestLayout = null;
            let minConflicts = Infinity;

            for (let i = 0; i < attempts; i++) {
                const shuffled = shuffleArray([...studentNames]);
                const candidate = {};
                let conflicts = 0;

                seats.forEach((seat, index) => {
                    const name = shuffled[index];
                    candidate[seat.seatId] = name;
                    if (previousAssignments[seat.seatId] === name) {
                        conflicts++;
                    }
                });

                if (conflicts < minConflicts) {
                    minConflicts = conflicts;
                    bestLayout = candidate;
                    if (conflicts === 0) break;
                }
            }

            return { layout: bestLayout, conflicts: minConflicts };
        }

        function shuffleAllSeats() {
            if (!studentNames.length) {
                setStatus("배정할 이름 목록이 없습니다.", "error");
                return;
            }

            const { layout, conflicts } = attemptNewLayout();
            if (!layout) {
                setStatus("새로운 배치를 만들지 못했어요. 다시 시도해 주세요.", "error");
                return;
            }

            applyLayout(layout);
            previousAssignments = { ...layout };
            renderSeatGroups();

            const timestamp = new Date().toLocaleTimeString("ko-KR", { hour: "2-digit", minute: "2-digit" });
            history.unshift({
                summary: "전체 좌석 재배치 완료",
                detail: conflicts === 0 ? "모든 인원이 새로운 자리에 앉았어요!" : `${conflicts}명은 지난 주와 같은 자리에 머물렀어요.`,
                time: timestamp
            });
            updateHistory();

            const statusText = conflicts === 0
                ? "완벽한 재배치 성공! 아무도 같은 자리에 머물지 않았어요."
                : `재배치를 완료했어요. ${conflicts}명은 지난 주와 같은 자리를 배정받았습니다.`;
            setStatus(statusText, conflicts === 0 ? "success" : "");
        }

        function restoreLastWeek() {
            applyLayout(lastWeekAssignments);
            previousAssignments = { ...lastWeekAssignments };
            renderSeatGroups();
            setStatus("지난 주 배치를 다시 불러왔어요.", "");
        }

        shuffleButton.addEventListener("click", shuffleAllSeats);
        restoreButton.addEventListener("click", restoreLastWeek);

        renderSeatGroups();
        updateHistory();
        setStatus("현재는 지난 주 배치를 표시하고 있어요. 버튼을 눌러 새로운 자리를 만들어 보세요.");
    </script>
</body>
</html>
