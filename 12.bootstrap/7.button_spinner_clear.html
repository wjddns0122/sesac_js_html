<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bootstrap demo</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
    </head>
    <body>
        <h1>로딩/클리어 버튼 구현하기</h1>
        <!-- 로딩 버튼 구현 -->
        <button id="loadBtn" class="btn btn-primary me-2">
            <span class="spinner-border spinner-border-sm d-none"></span>
            <span class="button-text">데이터 로딩</span>
        </button>

        <!-- 클리어버튼 -->
        <button id="clearBtn"></button>

        <div id="result" class="mt-4"><!-- 결과가 출력될 곳 --></div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            const loadBtn = document.getElementById("loadBtn");
            const spinner = loadBtn.querySelector(".spinner-border");
            const loadBtnText = loadBtn.querySelector(".button-text");
            const result = document.getElementById("result");

            loadBtn.addEventListener("click", async () => {
                loadBtn.disabled = true;
                spinner.classList.remove("d-none");
                loadBtnText.textContent = "로딩중...";

                // 일부로 1초 쉬기
                await new Promise((resolve) => setTimeout(resolve, 1000)); // 1초 기다렸다가 끝

                // 이제 Fetch 전구간을 try-except로 처리해야함..
                // 실제로 fetch로 불러오기... jsonplaceholder

                try {
                    const randomId = Math.floor(Math.random() * 10) + 1;
                    const resp = await fetch(
                        `https://jsonplaceholder.typicode.com/posts/${randomId}`
                    );
                    const data = await resp.json();
                    result.innerHTML = `
                        <div class="alert alert-success">
                            <h5>${data.title}</h5>
                            <p>${data.body}</p>
                        </div>
                    `;
                } catch (err) {
                    result.innerHTML = `
                    <div class="alert alert-danger">
                        데이터를 가져오는데 실패했습니다. 잠시 후 다시 시도해 주세요...
                    </div>
                    `;
                } finally {
                    // 버튼 원복
                    loadBtn.disabled = false;
                    spinner.classList.add("d-none");
                    loadBtnText.textContent = "데이터 로딩";
                }
            });
            clearBtn.addEventListener("click", async () => {
                claerBtn.disabled = true;
                result.innderHTML = `
                    <div class="alert alert-warning">
                        삭제 중...
                    </div>
                `;

                // 1초 대기
                await new Promise((resolve) => setTimeout(resolve, 1000));

                result.innerHTML = "";
            });
        </script>
    </body>
</html>
