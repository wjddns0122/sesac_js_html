<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
            crossorigin="anonymous"
        />
    </head>
    <body>
        <h1>로딩/클리어 버튼 구현하기!</h1>
        <!-- 로딩버튼 -->
        <button id="loadBtn" class="btn btn-primary me-2">
            <span class="spinner-border spinner-border-sm d-none"></span>
            <span class="button-text">데이터 로딩</span>
        </button>

        <!-- 클리어버튼 -->
        <button id="clearBtn" class="btn btn-danger me-2">
            <span class="spinner-border spinner-border-sm d-none"></span>
            <span class="button-text">데이터 삭제</span>
        </button>

        <div id="result" class="mt-4"><!-- 결과가 출력될곳 --></div>

        <script>
            /************************
        /* 로드 버튼
        /************************/
            const loadBtn = document.getElementById("loadBtn");
            const spinner = loadBtn.querySelector(".spinner-border");
            const loadBtnText = loadBtn.querySelector(".button-text");
            const result = document.getElementById("result");

            loadBtn.addEventListener("click", async () => {
                loadBtn.disabled = true;
                spinner.classList.remove("d-none");
                loadBtnText.textContent = "로딩중...";

                // 일부러 1초 쉬기...
                await new Promise((resolve) => setTimeout(resolve, 1000)); // 1초 기다렸다가 끝.

                // 아래 fetch 전구간을 try-except 로 처리해야함.
                // 실제로 fetch로 불러오기... jsonplacholder
                const randomId = Math.floor(Math.random() * 10) + 1; // 1 ~ 10

                try {
                    const resp = await fetch(
                        `https://jsonplaceholder.typicode.com/posts/${randomId}`
                    );
                    const data = await resp.json();
                    result.innerHTML = `
                    <div class="alert alert-success">
                        <h5>${data.title}</h5>
                        <p>${data.body}</p>
                    </div>
                `;
                } catch (error) {
                    result.innerHTML = `
                    <div class="alert alert-danger">
                        데이터를 가져오는데 실패했습니다. 잠시 후 다시 시도해 주세요...
                    </div>
                `;
                } finally {
                    // 성공하건 실패하건 공통 요소
                    // 버튼 원복
                    loadBtn.disabled = false;
                    spinner.classList.add("d-none");
                    loadBtnText.textContent = "데이터 로딩";
                    // 데이터 삭제 버튼도 활성화
                    clearBtn.disabled = false;
                }
            });

            /************************
        /* 클리어 버튼
        /************************/
            const clearBtn = document.getElementById("clearBtn");
            const spinner2 = clearBtn.querySelector(".spinner-border");
            const clearBtnText = clearBtn.querySelector(".button-text");
            clearBtn.disabled = true;

            // 나머지를 동일하게 구현하시오..
            clearBtn.addEventListener("click", async () => {
                clearBtn.disabled = true;
                result.innerHTML = `
                <div class="alert alert-warning">
                    <span class="spinner-border spinner-border-sm text-danger"></span>
                    삭제 중...
                </div>
            `;
                // 1초 대기
                await new Promise((resolve) => setTimeout(resolve, 1000));

                result.innerHTML = "";
            });
        </script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
