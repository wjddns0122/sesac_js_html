<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>착한아저씨 사이트에 CRUD 해보기</h1>
    <div>
        <h3>포스트 생성하기</h3>
        <button id="createPost">포스트 생성</button>
    </div>
    <div>
        <h3>포스트 조회하기</h3>
        <button id="readPost">포스트 조회</button>
        <input type="number" id="userId" placeholder="사용자 id를 입력하세요 (1~100)" value="1">
        <button id="prevBtn">prev</button>
        <button id="nextBtn">next</button>
    </div>
    <div>
        <h3>포스트 수정하기</h3>
        <button id="updatePost">포스트 수정 (현재 ID 기준)</button>
    </div>
    <div>
        <h3>포스트 삭제하기</h3>
        <button id="removePost">포스트 삭제 (현재 ID 기준)</button>
    </div>
    <div>
        <h3>공통결과를 출력할곳</h3>
        <pre id="result"></pre>
    </div>

    <script>
        const requestURL = `https://jsonplaceholder.typicode.com/posts`;
        const userIdInput = document.getElementById('userId');
        const resultBox = document.getElementById('result');

        function fetchPostById(id) {
            fetch(`${requestURL}/${id}`)
                .then((response) => {
                    if (!response.ok) throw new Error("네트워크 오류 또는 없는 게시물");
                    return response.json();
                })
                .then((data) => {
                    resultBox.textContent = JSON.stringify(data); 
                })
                .catch((error) => {
                    resultBox.textContent = error;
                    alert(error);
                });
        }

        document.getElementById('createPost').addEventListener('click', () => {
            const myPost = {
                title: 'sesac',
                body: 'seoul',
                userId: 1,
            };

            fetch(requestURL, {
                method: 'POST',
                headers: { 'Content-type': 'application/json; charset=UTF-8' },
                body: JSON.stringify(myPost)
            })
            .then(response => response.json())
            .then(data => {
                resultBox.textContent = JSON.stringify(data);
            })
            .catch(error => alert(error));
        });

        document.getElementById('readPost').addEventListener('click', () => {
            const currentId = userIdInput.value;
            if (!currentId) {
                alert("ID를 입력해주세요!");
                return;
            }
            fetchPostById(currentId);
        });

        document.getElementById('prevBtn').addEventListener('click', () => {
            let currentId = Number(userIdInput.value);
            
            if (currentId > 1) {
                currentId -= 1;             
                userIdInput.value = currentId;
                fetchPostById(currentId);   
            } else {
                alert("1보다 작을 수 없습니다.");
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            let currentId = Number(userIdInput.value);

            if (currentId < 100) {
                currentId += 1;            
                userIdInput.value = currentId;
                fetchPostById(currentId);   
            } else {
                alert("100보다 클 수 없습니다.");
            }
        });

        document.getElementById('updatePost').addEventListener('click', () => {
            const currentId = userIdInput.value || 1; 
            const targetURL = `${requestURL}/${currentId}`; 

            fetch(targetURL, {
                method: 'PATCH',
                headers: { 'Content-type': 'application/json; charset=UTF-8' },
                body: JSON.stringify({ title: '수정된 제목(foo)' })
            })
            .then(response => response.json())
            .then(data => {
                resultBox.textContent = JSON.stringify(data);
            })
            .catch(error => alert(error));
        });

        document.getElementById('removePost').addEventListener('click', () => {
            const currentId = userIdInput.value || 1; 
            const targetURL = `${requestURL}/${currentId}`;

            fetch(targetURL, {
                method: 'DELETE',
            })
            .then(response => {
                if (!response.ok) throw new Error("삭제 실패");
            })
            .then(data => document.getElementById('result').innerText = `${data}`)
            .catch(error => alert(error));
        });

    </script>
</body>
</html>